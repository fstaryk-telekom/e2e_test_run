name: "E2E Test Trigger Action"
description: "Triggers E2E tests using the provided originator service."
inputs:
  originator-service:
    description: "The originator service name (e.g., T-Roc)"
    required: true
runs:
  using: "composite"
  steps:
    - name: "Trigger E2E Tests"
      shell: bash
      run: |
        payload=$(jq -n --arg originator "${{ inputs.originator-service }}" '{originator: $originator}')
        run_start=$(curl -s -X POST -H "Content-Type: application/json" -d "$payload" "https://test-engine-backend-dev.apps.mega.cariad.cloud/e2e/run")
        echo "$run_start"
        run_id=$(echo "$run_start" | jq -r '.id')
        echo "Run ID: $run_id"
        for i in {300..0..10}; do
          echo "Sleeping for $i seconds..."
          sleep 10
        done
        test_result=$(curl -s "https://test-engine-backend-dev.apps.mega.cariad.cloud/testresults/$run_id")
        echo "$test_result"
        FAILED=$(echo "$test_result" | jq '[.scenarios[].result] | index("FAILURE")')
        if [ "$FAILED" != "null" ]; then
          echo "At least one scenario failed!"
          exit 1
        else
          echo "All scenarios passed!"
        fi

